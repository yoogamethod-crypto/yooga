<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Login e Cadastro - YOOGA SCRIPT</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #121212;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }
    .auth-container {
      background-color: #1e1e1e;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
      width: 300px;
      text-align: center;
    }
    .auth-container h2 {
      margin-bottom: 20px;
      color: #ff9800;
    }
    .auth-container input {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border: 1px solid #333;
      border-radius: 4px;
      background-color: #2a2a2a;
      color: #fff;
      box-sizing: border-box;
    }
    .auth-container input::placeholder {
      color: #888;
    }
    .auth-container button {
      width: 100%;
      padding: 10px;
      background-color: #ff9800;
      border: none;
      border-radius: 4px;
      color: #000;
      font-size: 16px;
      cursor: pointer;
    }
    .auth-container button:hover {
      background-color: #e68900;
    }
    .auth-container .error {
      color: #ff4d4d;
      font-size: 14px;
      margin-top: 10px;
      display: none;
    }
    .auth-container .toggle-link {
      margin-top: 15px;
      font-size: 14px;
      color: #fff;
    }
    .auth-container .toggle-link a {
      color: #ff9800;
      text-decoration: none;
      cursor: pointer;
    }
    .auth-container .toggle-link a:hover {
      text-decoration: underline;
    }
    .dashboard {
      width: 100%;
      padding: 20px;
      text-align: center;
      position: fixed;
      top: 0;
      left: 0;
    }
    .dashboard h1 {
      color: #ff9800;
      font-size: 24px;
      margin: 0;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="auth-container" id="auth-container">
    <!-- Login -->
    <div id="login-form">
      <h2>Login</h2>
      <div id="login-error" class="error">Usuário ou senha inválidos!</div>
      <input type="text" id="login-username" placeholder="Usuário" required />
      <input type="password" id="login-password" placeholder="Senha" required />
      <button onclick="login()">Entrar</button>
      <div class="toggle-link">
        Não tem uma conta? <a onclick="showRegister()">Cadastre-se</a>
      </div>
    </div>

    <!-- Cadastro -->
    <div id="register-form" class="hidden">
      <h2>Cadastro</h2>
      <div id="register-error" class="error"></div>
      <input type="text" id="register-username" placeholder="Usuário" required />
      <input type="email" id="register-email" placeholder="E-mail" required />
      <input type="password" id="register-password" placeholder="Senha" required />
      <input type="password" id="register-confirm-password" placeholder="Confirmar Senha" required />
      <button onclick="register()">Cadastrar</button>
      <div class="toggle-link">
        Já tem uma conta? <a onclick="showLogin()">Faça login</a>
      </div>
    </div>
  </div>

  <!-- Dashboard -->
  <div class="dashboard hidden" id="dashboard">
    <h1>YOOGA SCRIPT</h1>
  </div>

  <!-- Firebase SDK modular -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

    // Configuração do Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyCLedyIOD0UljVl3inHtniknib5pTMxRi4",
      authDomain: "databasesite-91e9c.firebaseapp.com",
      projectId: "databasesite-91e9c",
      storageBucket: "databasesite-91e9c.firebasestorage.app",
      messagingSenderId: "580715582665",
      appId: "1:580715582665:web:15b04f7b709d9a07462918",
      measurementId: "G-7MK2KWT763"
    };

    // Inicializar Firebase e Firestore
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Mostrar login
    window.showLogin = function () {
      document.getElementById("login-form").classList.remove("hidden");
      document.getElementById("register-form").classList.add("hidden");
      document.getElementById("dashboard").classList.add("hidden");
      document.getElementById("auth-container").classList.remove("hidden");
    };

    // Mostrar cadastro
    window.showRegister = function () {
      document.getElementById("register-form").classList.remove("hidden");
      document.getElementById("login-form").classList.add("hidden");
      document.getElementById("dashboard").classList.add("hidden");
      document.getElementById("auth-container").classList.remove("hidden");
    };

    // Mostrar dashboard
    window.showDashboard = function () {
      document.getElementById("auth-container").classList.add("hidden");
      document.getElementById("dashboard").classList.remove("hidden");
    };

    // Cadastro (Firestore)
    window.register = async function () {
      const username = document.getElementById("register-username").value.trim().toLowerCase();
      const email = document.getElementById("register-email").value.trim();
      const password = document.getElementById("register-password").value;
      const confirmPassword = document.getElementById("register-confirm-password").value;
      const errorMessage = document.getElementById("register-error");

      errorMessage.style.display = "none";
      if (!username || !email || !password || !confirmPassword) {
        errorMessage.textContent = "Por favor, preencha todos os campos!";
        errorMessage.style.display = "block";
        return;
      }

      if (password !== confirmPassword) {
        errorMessage.textContent = "As senhas não coincidem!";
        errorMessage.style.display = "block";
        return;
      }

      try {
        const userRef = doc(db, "users", username);
        const docSnap = await getDoc(userRef);

        if (docSnap.exists()) {
          errorMessage.textContent = "Nome de usuário já existe!";
          errorMessage.style.display = "block";
          return;
        }

        // Salva no Firestore
        await setDoc(userRef, {
          email: email,
          password: password,
        });

        alert("Cadastro realizado com sucesso!");
        showLogin();
      } catch (error) {
        console.error("Erro ao cadastrar:", error);
        errorMessage.textContent = "Erro ao conectar com o servidor!";
        errorMessage.style.display = "block";
      }
    };

    // Login (Firestore)
    window.login = async function () {
      const username = document.getElementById("login-username").value.trim().toLowerCase();
      const password = document.getElementById("login-password").value;
      const errorMessage = document.getElementById("login-error");

      errorMessage.style.display = "none";

      try {
        const userRef = doc(db, "users", username);
        const docSnap = await getDoc(userRef);

        if (docSnap.exists() && docSnap.data().password === password) {
          showDashboard();
        } else {
          errorMessage.textContent = "Usuário ou senha inválidos!";
          errorMessage.style.display = "block";
        }
      } catch (error) {
        console.error("Erro ao logar:", error);
        errorMessage.textContent = "Erro ao conectar com o servidor!";
        errorMessage.style.display = "block";
      }
    };
  </script>
</body>
</html>
